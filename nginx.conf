events {
    worker_connections 1024;
}

http {
    upstream backend {
        server mudmaps-backend:3000;
    }

    upstream frontend {
        server mudmaps-frontend:80;
    }

    server {
      listen 80;
      server_name _;

      # Serve the SPA
      root /usr/share/nginx/html;
      index index.html;

      location /assets/ {
        try_files $uri =404;
      }

      location / {
        try_files $uri /index.html;
      }

      # Reverse-proxy API to the backend container
      location /api/ {
        proxy_pass http://backend:3000/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $remote_addr;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_read_timeout 120s;
      }

      # Optional: reverse-proxy OSRM if/when you add it
      # location /osrm/ {
      #   proxy_pass http://osrm:5000/;
      #   proxy_set_header Host $host;
      #   proxy_set_header X-Forwarded-For $remote_addr;
      # }
    }
}